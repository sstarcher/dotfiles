week(){
  date +%V
}

sha_diverge(){
  export SHA=${1}; git log --pretty=oneline $(git merge-base origin/master ${SHA})..${SHA}
}

tf(){
    terraform "$@" | landscape
}

patch(){
    git checkout master
    git pull
    TAG=$(helm release . --print-computed-version --bump patch)
    git tag -a -m 'tagging release' $TAG
    git push origin $TAG
}

minor(){
    git checkout master
    git pull
    TAG=$(helm release . --print-computed-version --bump minor)
    git tag -a -m 'tagging release' $TAG
    git push origin $TAG
}

tag(){
    if [ "$#" -ne 2 ]; then
        echo "Expected 2 parameters, but got $#"
        echo "tag TAG MESSAGE"
        return 1
    fi

    TAG=$1
    MESSAGE=$2

    if [ -z "$GREN_GITHUB_TOKEN" ]; then
        echo 'GREN_GITHUB_TOKEN must be set'
        return 1
    fi

    BRANCH=$(git rev-parse --abbrev-ref HEAD)
    if [ "$BRANCH" != "master" ]; then
        echo 'switching to master'
        git checkout master
    fi

    git pull
    git tag -a "$TAG" -m "$MESSAGE"
    git push origin "$TAG"

    gren release -D commits
}

export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
export PATH="$HOME/.stuff/bin:$PATH"
export PATH=$HOME/.gloo/bin:$PATH
export TF_PLUGIN_CACHE_DIR="$HOME/.terraform.d/plugin-cache"


alias k="kubectl"

alias kgp='kubectl get pods'

alias kgs='kubectl get svc'

alias kgc='kubectl get componentstatuses'

alias kctx='kubectl config current-context'

alias kcon='kubectl config use-context'

alias kgc='kubectl config get-context'

alias kne="kubectl describe nodes | egrep 'Events|Name:' | grep -v 'none'"

alias gf='git commit --fixup HEAD .'

alias pr='git push -u && hub pull-request -o'

alias git=hub

find-envs () {
  file='envs.sh'
  dir=$(pwd)
  while [[ "$dir" != "" ]]; do
    if [[ -f "$dir/$file" ]]; then
        source "$dir/$file"
    fi
    dir=${dir%/*}
  done
}

func tg(){
    case "$@" in
        *plan* ) ;&
        *apply* ) terragrunt "$@" -input=false | landscape ;;
        * ) terragrunt "$@" ;;
    esac
}

func tf(){
    case "$@" in
        *plan*) ;&
        *apply*) terraform "$@" -input=false | landscape ;;
        *) terraform "$@" ;;
    esac
}

alias no_ansi="sed 's/\x1b\[[0-9;]*m//g'"
alias openssl_crt='openssl x509 -noout -modulus -in'
alias openssl_key='openssl rsa -noout -modulus -in'
alias openssl_csr='openssl req -noout -modulus -in'

